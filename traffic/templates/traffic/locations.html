{% extends "base.html" %}

{% block title %} 实验室物品管理 {% endblock %}

{% block content %}
{% if loc_data %}
<p class="lead">今日活跃</p>
<div id="main1" class="col-sm-12" style="height: 300px;"></div>
{% endif %}
<p class="lead">位置关系</p>
<div id="main2" class="col-sm-12 border" style="height: 600px;"></div>
<div id="main3" class="col-sm-12 border" style="height: 600px;"></div>



{% endblock %}

{% block script %}
<script src="https://cdn.bootcss.com/echarts/4.2.0-rc.2/echarts.min.js"></script>
{% if loc_data %}
<script>
option = {
    tooltip: {},
    series : [
        {
            name: '操作次数',
            type: 'pie',
            radius: '55%',
            data: {{ loc_data|safe }}
        }
    ]
};
var myChart = echarts.init(document.getElementById('main1'));
myChart.setOption(option);
</script>
{% endif %}
<script>
data = {{ loc_node|safe }}
norm = function(node){
    node.symbolSize = Math.sqrt(node.value/{{ item_count }}) * 60 + 10;
    node.children.forEach(norm)
};
norm(data);
option = {
    tooltip: {},
    animationDurationUpdate: 1500,
    animationEasingUpdate: 'quinticInOut',
    toolbox: {
        feature: {
            saveAsImage: {}
        }
    },
    series : [
        {
            type: 'tree',
            name: 'loc_tree',
            data: [data],
            initialTreeDepth: -1,
            symbolSize: 7,
            label: {
                normal: {
                    position: 'left',
                    verticalAlign: 'middle',
                    align: 'right'
                }
            },
            leaves: {
                label: {
                    normal: {
                        position: 'right',
                        verticalAlign: 'middle',
                        align: 'left'
                    }
                }
            },
            expandAndCollapse: true,
            animationDuration: 550,
            animationDurationUpdate: 750
        }
    ]
};
var myChart = echarts.init(document.getElementById('main2'));
myChart.setOption(option);
function colorMappingChange(value) {
    var levelOption = getLevelOption(value);
    chart.setOption({
        series: [{
            levels: levelOption
        }]
    });
}

var formatUtil = echarts.format;

function getLevelOption() {
    return [
        {
            itemStyle: {
                normal: {
                    borderWidth: 0,
                    gapWidth: 5
                }
            }
        },
        {
            itemStyle: {
                normal: {
                    gapWidth: 1
                }
            }
        },
        {
            colorSaturation: [0.35, 0.5],
            itemStyle: {
                normal: {
                    gapWidth: 1,
                    borderColorSaturation: 0.6
                }
            }
        }
    ];
}
option = {
    title: {
        text: 'Room Usage',
        left: 'center'
    },

    tooltip: {
        formatter: function (info) {
            var value = info.value;
            var treePathInfo = info.treePathInfo;
            var treePath = [];

            for (var i = 1; i < treePathInfo.length; i++) {
                treePath.push(treePathInfo[i].name);
            }

            return [
                '<div class="tooltip-title">' + formatUtil.encodeHTML(treePath.join('-')) + '</div>',
                'Room Usage: ' + formatUtil.addCommas(value) + ' 件',
            ].join('');
        }
    },

    series: [
        {
            name:'Disk Usage',
            type:'treemap',
            visibleMin: 300,
            label: {
                show: true,
                formatter: '{b}'
            },
            itemStyle: {
                normal: {
                    borderColor: '#fff'
                }
            },
            levels: getLevelOption(),
            data: data.children
        }
    ]
};
var myChart = echarts.init(document.getElementById('main3'));
myChart.setOption(option);
</script>
{% endblock %}