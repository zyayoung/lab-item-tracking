{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}{{ action }}{{ name }}{% endblock %}
{% block css %}{% endblock %}
{% block content %}
<p class="lead">{{ action }}{{ name }}：</p>
<form class="form-add" action="" method="post">
    {% csrf_token %}
    <div class="form-group row">
        <div class="col-3">{{ add_form.public.label }}</div>
        <div class="col-9">
            <div class="form-check">
                <input type="checkbox" name="public" class="form-check-input" id="id_public"
                {% if item.is_public or action == "新建" %}checked{% endif %}>
            </div>
        </div>
    </div>
    <div class="form-group row">
        <label class="col-3 col-form-label">类型</label>
        <div class="col-9">{{ choose_form.template }}</div>
    </div>
    <div id="innerform">
    </div>
    <button type="submit" class="btn btn-outline-primary">提交</button>
</form>
{% endblock %}
{% block script %}
<script>
    False = false;
    True = true;
    None = null;
    data = {% if item.extra_data %}{{ item.extra_data | safe }}{% else %}{}{% endif %};

    function ajaxSubmit() {
        var id = $.trim($('#id_template').val());
        $.ajax({
            url: '{% url "inventory:templateAjax" %}',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'id': Number(id),
            },
            success: function (arg) {
                $('#innerform').html(arg);
                Object.keys(data).forEach(function (key) {
                    if (data[key] === True)
                        $('#id_' + key.replace(/ /g, '_')).prop("checked", true);
                    else if (data[key] === False)
                        $('#id_' + key.replace(/ /g, '_')).prop("checked", false);
                    else
                        $('#id_' + key.replace(/ /g, '_')).val(data[key]);
                });
                $('#id_name').val('{{ item.name|safe }}');
            }
        });
    }
    $('#id_template').change(function () {
        ajaxSubmit()
    });
    $(function () {
        $('#id_template').val({{ item.template.id }});
        ajaxSubmit();
    });
</script>
{% endblock %}